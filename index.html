<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="https://diviengine.com/wp-content/uploads/2023/01/ChatGPT-Logooptimized-610x610.png" />
    <title>Texto GPT</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script>
</head>

<body>
    <div class="container mt-5">
        <h3 style="margin-bottom: 2rem;">BilacBot</h3>

        <label for="apiKeyInput">API Key:</label>
        <input type="text" id="apiKeyInput" class="form-control" placeholder="Insira sua API Key aqui">

        <label class="mt-2" for="themeToggle">Modo Escuro:</label>
        <input type="checkbox" id="themeToggle">

        <!-- Dropdown para escolher a região -->
        <div>
            <label class="mt-2" for="regiaoDropdown" style="font-size: 1.3rem;">Escolha a região:</label>
        </div>
        <select class="form-control" id="regiaoDropdown" style="margin-bottom: 2rem;">
            <option value="norte">Norte</option>
            <option value="nordeste">Nordeste</option>
            <option value="sudeste">Sudeste</option>
            <option value="sul">Sul</option>
            <option value="centro-oeste">Centro-Oeste</option>
        </select>

        <textarea id="textInput" class="form-control my-3" rows="10" placeholder="Escreva seu texto aqui..."></textarea>

        <div class="btn-group mt-2">
            <button id="ampliarButton" class="btn btn-primary">Ampliar texto</button>
            <button id="corrigirButton" class="btn btn-warning">Corrigir texto</button>
            <button id="converterRegiaoButton" class="btn btn-success">Converter para Região</button>
            <button id="detectarRegiaoButton" class="btn btn-info">Detectar Região</button>
            <button id="verificarGramaticaButton" class="btn btn-danger">Verificação Gramatical</button>
            <button id="copiarButton" class="btn btn-secondary">Copiar texto gerado</button>
        </div>

        <div class="mt-4" id="gptOutput">
            <span id="loading"></span>
        </div>
        <div class="mt-4" id="comparisonOutput"></div>
    </div>

    <script>
        const textInput = $("#textInput");
        const gptOutput = $("#gptOutput");
        const regiaoDropdown = $("#regiaoDropdown");

        $("#ampliarButton").on("click", () => {
            sendToGPT("amplie esse texto: " + textInput.val());
        });

        $("#corrigirButton").on("click", () => {
            sendToGPT("corrija esse texto: " + textInput.val());
        });

        $("#copiarButton").on("click", () => {
            const textArea = document.createElement("textarea");
            textArea.value = gptOutput.text();
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        });

        $("#converterRegiaoButton").on("click", () => {
            sendToGPT("Converta este texto para o estilo da região " + regiaoDropdown.val() + " do Brasil: " + textInput.val());
        });

        $("#detectarRegiaoButton").on("click", () => {
            sendToGPT("Qual região do Brasil esse texto corresponde: " + textInput.val());
        });

        // Função de verificação gramatical
        $("#verificarGramaticaButton").on("click", () => {
            let originalText = textInput.val();
            sendToGPTForGrammarCheck("corrija esse texto gramaticalmente: " + originalText, originalText);
        });

        function sendToGPT(prompt) {
            const apiKey = $("#apiKeyInput").val();

            $("#loading").text("Seu texto está sendo processado, aguarde por favor...");

            var settings = {
                url: "https://api.openai.com/v1/chat/completions",
                method: "POST",
                timeout: 0,
                headers: {
                    "Authorization": "Bearer " + apiKey,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{
                        "role": "user",
                        "content": prompt
                    }]
                })
            };

            $.ajax(settings).done(function (response) {
                const message = response.choices[0].message.content;
                $("#loading").text("");
                gptOutput.html(message);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                $("#loading").text("");
                gptOutput.html("Erro: " + jqXHR.responseJSON.error.message);
            });
        }

        function sendToGPTForGrammarCheck(prompt, originalText) {
            const apiKey = $("#apiKeyInput").val();
            $("#loading").text("Verificando gramática, aguarde por favor...");

            var settings = {
                url: "https://api.openai.com/v1/chat/completions",
                method: "POST",
                timeout: 0,
                headers: {
                    "Authorization": "Bearer " + apiKey,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{
                        "role": "user",
                        "content": prompt
                    }]
                })
            };

            $.ajax(settings).done(function (response) {
                const correctedText = response.choices[0].message.content;
                showTextComparison(originalText, correctedText);
                $("#loading").text("");
            }).fail(function (jqXHR, textStatus, errorThrown) {
                $("#loading").text("");
                gptOutput.html("Erro: " + jqXHR.responseJSON.error.message);
            });
        }

        function showTextComparison(original, corrected) {
            let originalWords = original.split(" ");
            let correctedWords = corrected.split(" ");
            let comparisonHtml = "<strong>Original:</strong> ";

            originalWords.forEach((word, index) => {
                if (word !== correctedWords[index]) {
                    comparisonHtml += `<span style="background-color: yellow">${word}</span> `;
                } else {
                    comparisonHtml += word + " ";
                }
            });

            comparisonHtml += "<br><strong>Corrigido:</strong> ";

            correctedWords.forEach((word, index) => {
                if (word !== originalWords[index]) {
                    comparisonHtml += `<span style="background-color: green; color: white">${word}</span> `;
                } else {
                    comparisonHtml += word + " ";
                }
            });

            $("#comparisonOutput").html(comparisonHtml);
        }

        // Dark mode toggle
        $('#themeToggle').change(function () {
            if ($(this).prop('checked')) {
                $('body').css('background-color', 'black');
                $('body').css('color', 'white');
            } else {
                $('body').css('background-color', 'white');
                $('body').css('color', 'black');
            }
        });

    </script>
</body>

</html>


<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png"
        href="https://diviengine.com/wp-content/uploads/2023/01/ChatGPT-Logooptimized-610x610.png" />
    <title>Texto GPT</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script>
</head>


<style>
    .custom-output {
        background: #f7f9fc;
        background: linear-gradient(135deg, #f7f9fc, #e6e9ef);
        border: 2px solid #dee2e6;
        color: #333;
    }
</style>

<body>
    <div class="container mt-5">
        <h3 style="margin-bottom: 2rem;">BilacBot</h3>

        <label for="apiKeyInput">API Key:</label>
        <input type="text" id="apiKeyInput" class="form-control" placeholder="Insira sua API Key aqui">

        <label class="mt-2" for="themeToggle">Modo Escuro:</label>
        <input type="checkbox" id="themeToggle">

        <div>
            <label class="mt-2" for="regiaoDropdown" style="font-size: 1.3rem;">Escolha a região:</label>
        </div>
        <select class="form-control" id="regiaoDropdown" style="margin-bottom: 2rem;">
            <option value="norte">Norte</option>
            <option value="nordeste">Nordeste</option>
            <option value="sudeste">Sudeste</option>
            <option value="sul">Sul</option>
            <option value="centro-oeste">Centro-Oeste</option>
        </select>

        <textarea id="textInput" class="form-control my-3" rows="10" placeholder="Escreva seu texto aqui..."></textarea>

        <div class="btn-group mt-2" style="gap:5px;">
            <button id="ampliarButton" class="btn btn-primary">Ampliar texto</button>
            <button id="corrigirButton" class="btn btn-warning">Corrigir texto</button>
            <button id="converterRegiaoButton" class="btn btn-success">Converter para Região</button>
            <button id="detectarRegiaoButton" class="btn btn-info">Detectar Região</button>
            <button id="verificarGramaticaButton" class="btn btn-danger">Verificação Gramatical</button>
            <button id="copiarButton" class="btn btn-secondary">Copiar texto gerado</button>
        </div>


        <div class="mt-4 custom-output p-4 rounded-lg shadow" id="gptOutput" style="display: none;">
            <span id="loading"></span>
            <span id="gptResult" class="" style="font-size: 1.17rem;">
            </span>
        </div>




        <div class=" mt-4 gap-5" id="comparisonOutput" style="display: none; gap:5px">
            <div class="w-50 p-3 border" id="originalOutput"></div>
            <div class="w-50 p-3 border" id="correctedOutput"></div>
        </div>
    </div>

    <script>
        const textInput = $("#textInput");
        const regiaoDropdown = $("#regiaoDropdown");

        $("#ampliarButton").on("click", () => {
            $("#gptResult").text("");
            $("#gptOutput").css("display", "block");

            sendToGPT("amplie esse texto: " + textInput.val());
        });

        $("#corrigirButton").on("click", () => {
            $("#gptResult").text("");
            $("#gptOutput").css("display", "block");

            sendToGPT("corrija esse texto: " + textInput.val());
        });

        $("#copiarButton").on("click", () => {
            const textArea = document.createElement("textarea");
            textArea.value = $("#gptResult").text();
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        });

        $("#converterRegiaoButton").on("click", () => {
            $("#gptResult").text("");
            $("#gptOutput").css("display", "block");

            sendToGPT("Converta este texto para o estilo da região " + regiaoDropdown.val() + " do Brasil: " + textInput.val());
        });

        $("#detectarRegiaoButton").on("click", () => {
            $("#gptResult").text("");
            $("#gptOutput").css("display", "block");

            sendToGPT("Qual região do Brasil esse texto corresponde: " + textInput.val());
        });

        // Função de verificação gramatical
        $("#verificarGramaticaButton").on("click", () => {
            $("#gptResult").text("");
            let originalText = textInput.val();
            sendToGPTForGrammarCheck("corrija esse texto gramaticalmente: " + originalText, originalText);
        });

        function sendToGPT(prompt) {
            const apiKey = $("#apiKeyInput").val();

            $("#loading").text("Seu texto está sendo processado, aguarde por favor...");

            var settings = {
                url: "https://api.openai.com/v1/chat/completions",
                method: "POST",
                timeout: 0,
                headers: {
                    "Authorization": "Bearer " + apiKey,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{
                        "role": "user",
                        "content": prompt
                    }]
                })
            };

            $.ajax(settings).done(function (response) {
                const message = response.choices[0].message.content;
                $("#loading").text("");
                $("#gptResult").html(message);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                $("#loading").text("");
                $("#gptResult").html("Erro: " + jqXHR.responseJSON.error.message);
            });
        }

        function sendToGPTForGrammarCheck(prompt, originalText) {
            const apiKey = $("#apiKeyInput").val();
            $("#loading").text("Verificando gramática, aguarde por favor...");

            var settings = {
                url: "https://api.openai.com/v1/chat/completions",
                method: "POST",
                timeout: 0,
                headers: {
                    "Authorization": "Bearer " + apiKey,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{
                        "role": "user",
                        "content": prompt
                    }]
                })
            };

            $.ajax(settings).done(function (response) {
                const correctedText = response.choices[0].message.content;
                showTextComparison(originalText, correctedText);
                $("#loading").text("");
                $("#gptOutput").css("display", "none");


                $("#comparisonOutput").css("display", "flex");
            }).fail(function (jqXHR, textStatus, errorThrown) {
                $("#loading").text("");
                $("#gptResult").html("Erro: " + jqXHR.responseJSON.error.message);
            });
        }

        function showTextComparison(original, corrected) {
            let originalHtml = "<strong>Original:</strong> <br>";
            let correctedHtml = "<strong>Corrigido:</strong> <br>";

            let originalWords = original.split(" ");
            let correctedWords = corrected.split(" ");

            originalWords.forEach((word, index) => {
                if (word !== correctedWords[index]) {
                    originalHtml += `<span style="background-color: yellow">${word}</span> `;
                } else {
                    originalHtml += word + " ";
                }
            });

            correctedWords.forEach((word, index) => {
                if (word !== originalWords[index]) {
                    correctedHtml += `<span style="background-color: green; color: white">${word}</span> `;
                } else {
                    correctedHtml += word + " ";
                }
            });

            $("#originalOutput").html(originalHtml);
            $("#correctedOutput").html(correctedHtml);
        }


        // Dark mode toggle
        $('#themeToggle').change(function () {
            if ($(this).prop('checked')) {
                $('body').css('background-color', 'black');
                $('body').css('color', 'white');
            } else {
                $('body').css('background-color', 'white');
                $('body').css('color', 'black');
            }
        });

        // Função para aplicar o modo escuro
        function applyDarkMode(isDarkMode) {
            if (isDarkMode) {
                $('body').css('background-color', 'black');
                $('body').css('color', 'white');
                $('#themeToggle').prop('checked', true);
            } else {
                $('body').css('background-color', 'white');
                $('body').css('color', 'black');
                $('#themeToggle').prop('checked', false);
            }
        }

        // Evento para escutar a mudança no checkbox
        $('#themeToggle').change(function () {
            let isDarkMode = $(this).prop('checked');
            applyDarkMode(isDarkMode);


            localStorage.setItem('darkMode', isDarkMode);
        });

        // Ao carregar a página, verifica a preferência no localStorage
        $(document).ready(function () {
            let isDarkMode = localStorage.getItem('darkMode') === 'true';
            applyDarkMode(isDarkMode);
        });


    </script>
</body>

</html>